"use strict";var _=require("../util/_"),$=require("../util/preconditions"),BN=require("../crypto/bn"),BufferReader=function e(t){if(!(this instanceof e))return new e(t);if(!_.isUndefined(t))if(Buffer.isBuffer(t))this.set({buf:t});else if(_.isString(t)){var r=Buffer.from(t,"hex");if(2*r.length!==t.length)throw new TypeError("Invalid hex string");this.set({buf:r})}else{if(!_.isObject(t))throw new TypeError("Unrecognized argument for BufferReader");var s=t;this.set(s)}};BufferReader.prototype.set=function(e){return this.buf=e.buf||this.buf||void 0,this.pos=e.pos||this.pos||0,this},BufferReader.prototype.eof=function(){return this.pos>=this.buf.length},BufferReader.prototype.finished=BufferReader.prototype.eof,BufferReader.prototype.read=function(e){$.checkArgument(!_.isUndefined(e),"Must specify a length");var t=this.buf.slice(this.pos,this.pos+e);return this.pos=this.pos+e,t},BufferReader.prototype.readAll=function(){var e=this.buf.slice(this.pos,this.buf.length);return this.pos=this.buf.length,e},BufferReader.prototype.readUInt8=function(){var e=this.buf.readUInt8(this.pos);return this.pos=this.pos+1,e},BufferReader.prototype.readUInt16BE=function(){var e=this.buf.readUInt16BE(this.pos);return this.pos=this.pos+2,e},BufferReader.prototype.readUInt16LE=function(){var e=this.buf.readUInt16LE(this.pos);return this.pos=this.pos+2,e},BufferReader.prototype.readUInt32BE=function(){var e=this.buf.readUInt32BE(this.pos);return this.pos=this.pos+4,e},BufferReader.prototype.readUInt32LE=function(){var e=this.buf.readUInt32LE(this.pos);return this.pos=this.pos+4,e},BufferReader.prototype.readInt32LE=function(){var e=this.buf.readInt32LE(this.pos);return this.pos=this.pos+4,e},BufferReader.prototype.readUInt64BEBN=function(){var e=this.buf.slice(this.pos,this.pos+8),t=BN.fromBuffer(e);return this.pos=this.pos+8,t},BufferReader.prototype.readUInt64LEBN=function(){var e,t=this.buf.readUInt32LE(this.pos),r=4294967296*this.buf.readUInt32LE(this.pos+4)+t;if(r<=9007199254740991)e=new BN(r);else{var s=Array.prototype.slice.call(this.buf,this.pos,this.pos+8);e=new BN(s,10,"le")}return this.pos=this.pos+8,e},BufferReader.prototype.readVarintNum=function(){var e=this.readUInt8();switch(e){case 253:return this.readUInt16LE();case 254:return this.readUInt32LE();case 255:var t=this.readUInt64LEBN().toNumber();if(t<=Math.pow(2,53))return t;throw new Error("number too large to retain precision - use readVarintBN");default:return e}},BufferReader.prototype.readVarLengthBuffer=function(){var e=this.readVarintNum(),t=this.read(e);return $.checkState(t.length===e,"Invalid length while reading varlength buffer. Expected to read: "+e+" and read "+t.length),t},BufferReader.prototype.readVarintBuf=function(){switch(this.buf.readUInt8(this.pos)){case 253:return this.read(3);case 254:return this.read(5);case 255:return this.read(9);default:return this.read(1)}},BufferReader.prototype.readVarintBN=function(){var e=this.readUInt8();switch(e){case 253:return new BN(this.readUInt16LE());case 254:return new BN(this.readUInt32LE());case 255:return this.readUInt64LEBN();default:return new BN(e)}},BufferReader.prototype.reverse=function(){for(var e=Buffer.alloc(this.buf.length),t=0;t<e.length;t++)e[t]=this.buf[this.buf.length-1-t];return this.buf=e,this},BufferReader.prototype.readReverse=function(e){_.isUndefined(e)&&(e=this.buf.length);var t=this.buf.slice(this.pos,this.pos+e);return this.pos=this.pos+e,Buffer.from(t).reverse()},module.exports=BufferReader;