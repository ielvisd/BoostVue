"use strict";var _=require("../util/_"),BN=require("../crypto/bn"),buffer=require("buffer"),JSUtil=require("../util/javas"),BufferWriter=require("../encoding/bufferwriter"),Varint=require("../encoding/varint"),Script=require("../script"),$=require("../util/preconditions"),errors=require("../errors"),MAX_SAFE_INTEGER=9007199254740991;function Output(t){if(!(this instanceof Output))return new Output(t);if(!_.isObject(t))throw new TypeError("Unrecognized argument for Output");var r;this.satoshis=t.satoshis,Buffer.isBuffer(t.script)?this._scriptBuffer=t.script:(r=_.isString(t.script)&&JSUtil.isHexa(t.script)?buffer.Buffer.from(t.script,"hex"):t.script,this.setScript(r))}Object.defineProperty(Output.prototype,"script",{configurable:!1,enumerable:!0,get:function(){return this._script||this.setScriptFromBuffer(this._scriptBuffer),this._script}}),Object.defineProperty(Output.prototype,"satoshis",{configurable:!1,enumerable:!0,get:function(){return this._satoshis},set:function(t){t instanceof BN?(this._satoshisBN=t,this._satoshis=t.toNumber()):_.isString(t)?(this._satoshis=parseInt(t),this._satoshisBN=BN.fromNumber(this._satoshis)):($.checkArgument(JSUtil.isNaturalNumber(t),"Output satoshis is not a natural number"),this._satoshisBN=BN.fromNumber(t),this._satoshis=t),$.checkState(JSUtil.isNaturalNumber(this._satoshis),"Output satoshis is not a natural number")}}),Output.prototype.invalidSatoshis=function(){return this._satoshis>MAX_SAFE_INTEGER?"transaction txout satoshis greater than max safe integer":this._satoshis!==this._satoshisBN.toNumber()?"transaction txout satoshis has corrupted value":this._satoshis<0&&"transaction txout negative"},Object.defineProperty(Output.prototype,"satoshisBN",{configurable:!1,enumerable:!0,get:function(){return this._satoshisBN},set:function(t){this._satoshisBN=t,this._satoshis=t.toNumber(),$.checkState(JSUtil.isNaturalNumber(this._satoshis),"Output satoshis is not a natural number")}}),Output.prototype.toObject=Output.prototype.toJSON=function(){var t={satoshis:this.satoshis};return t.script=this._scriptBuffer.toString("hex"),t},Output.fromObject=function(t){return new Output(t)},Output.prototype.setScriptFromBuffer=function(t){this._scriptBuffer=t;try{this._script=Script.fromBuffer(this._scriptBuffer),this._script._isOutput=!0}catch(t){if(!(t instanceof errors.Script.InvalidBuffer))throw t;this._script=null}},Output.prototype.setScript=function(t){if(t instanceof Script)this._scriptBuffer=t.toBuffer(),this._script=t,this._script._isOutput=!0;else if(_.isString(t))this._script=Script.fromString(t),this._scriptBuffer=this._script.toBuffer(),this._script._isOutput=!0;else{if(!Buffer.isBuffer(t))throw new TypeError("Invalid argument type: script");this.setScriptFromBuffer(t)}return this},Output.prototype.inspect=function(){var t;return t=this.script?this.script.inspect():this._scriptBuffer.toString("hex"),"<Output ("+this.satoshis+" sats) "+t+">"},Output.fromBufferReader=function(t){var r={};r.satoshis=t.readUInt64LEBN();var i=t.readVarintNum();return r.script=0!==i?t.read(i):buffer.Buffer.from([]),new Output(r)},Output.prototype.toBufferWriter=function(t){t||(t=new BufferWriter),t.writeUInt64LEBN(this._satoshisBN);var r=this._scriptBuffer;return t.writeVarintNum(r.length),t.write(r),t},Output.prototype.getSize=function(){var t=this.script.toBuffer().length;return 8+Varint(t).toBuffer().length+t},module.exports=Output;