"use strict";var _=require("./util/_"),JSUtil=require("./util/javas"),networks=[],networkMaps={};function Network(){}function get(e,t){if(~networks.indexOf(e))return e;if(!t)return networkMaps[e];_.isArray(t)||(t=[t]);for(var r=0;r<networks.length;r++){var n=networks[r],s=_.pick(n,t);if(~_.values(s).indexOf(e))return n}}function cashAddrPrefixToArray(e){for(var t=[],r=0;r<e.length;r++)t.push(31&e.charCodeAt(r));return t}function addNetwork(e){var t=new Network;JSUtil.defineImmutable(t,{name:e.name,alias:e.alias,pubkeyhash:e.pubkeyhash,privatekey:e.privatekey,scripthash:e.scripthash,xpubkey:e.xpubkey,xprivkey:e.xprivkey});var r=e.indexBy||Object.keys(e);return e.cashAddrPrefix&&_.extend(t,{cashAddrPrefix:e.cashAddrPrefix,cashAddrPrefixArray:cashAddrPrefixToArray(e.cashAddrPrefix)}),e.networkMagic&&_.extend(t,{networkMagic:JSUtil.integerAsBuffer(e.networkMagic)}),e.port&&_.extend(t,{port:e.port}),e.dnsSeeds&&_.extend(t,{dnsSeeds:e.dnsSeeds}),networks.push(t),indexNetworkBy(t,r),t}function indexNetworkBy(e,t){for(var r=0;r<t.length;r++){var n=e[t[r]];_.isUndefined(n)||_.isObject(n)||(networkMaps[n]=e)}}function unindexNetworkBy(e,t){for(var r=0;r<t.length;r++){var n=t[r];networkMaps[n]===e&&delete networkMaps[n]}}function removeNetwork(e){for(var t=0;t<networks.length;t++)networks[t]===e&&networks.splice(t,1);unindexNetworkBy(e,Object.keys(networkMaps))}Network.prototype.toString=function(){return this.name};var networkMagic={livenet:3823236072,testnet:4108710900,regtest:3669344250,stn:4224632057},dnsSeeds=["seed.bitcoinsv.org","seed.bitcoinunlimited.info"],TESTNET={PORT:18333,NETWORK_MAGIC:networkMagic.testnet,DNS_SEEDS:dnsSeeds,PREFIX:"testnet",CASHADDRPREFIX:"bchtest"},REGTEST={PORT:18444,NETWORK_MAGIC:networkMagic.regtest,DNS_SEEDS:[],PREFIX:"regtest",CASHADDRPREFIX:"bchreg"},STN={PORT:9333,NETWORK_MAGIC:networkMagic.stn,DNS_SEEDS:["stn-seed.bitcoinsv.io"],PREFIX:"stn",CASHADDRPREFIX:"bsvstn"},liveNetwork={name:"livenet",alias:"mainnet",prefix:"bitcoin",cashAddrPrefix:"bitcoincash",pubkeyhash:0,privatekey:128,scripthash:5,xpubkey:76067358,xprivkey:76066276,networkMagic:networkMagic.livenet,port:8333,dnsSeeds},testNetwork={name:"testnet",prefix:TESTNET.PREFIX,cashAddrPrefix:TESTNET.CASHADDRPREFIX,pubkeyhash:111,privatekey:239,scripthash:196,xpubkey:70617039,xprivkey:70615956,networkMagic:TESTNET.NETWORK_MAGIC},regtestNetwork={name:"regtest",prefix:REGTEST.PREFIX,cashAddrPrefix:REGTEST.CASHADDRPREFIX,pubkeyhash:111,privatekey:239,scripthash:196,xpubkey:70617039,xprivkey:70615956,networkMagic:REGTEST.NETWORK_MAGIC,port:REGTEST.PORT,dnsSeeds:[],indexBy:["port","name","cashAddrPrefix","networkMagic"]},stnNetwork={name:"stn",prefix:STN.PREFIX,cashAddrPrefix:STN.CASHADDRPREFIX,pubkeyhash:111,privatekey:239,scripthash:196,xpubkey:70617039,xprivkey:70615956,networkMagic:STN.NETWORK_MAGIC,indexBy:["port","name","cashAddrPrefix","networkMagic"]};addNetwork(testNetwork),addNetwork(stnNetwork),addNetwork(regtestNetwork),addNetwork(liveNetwork);var livenet=get("livenet"),regtest=get("regtest"),testnet=get("testnet"),stn=get("stn");function enableRegtest(){testnet.regtestEnabled=!0}function disableRegtest(){testnet.regtestEnabled=!1}function enableStn(){testnet.stnEnabled=!0}function disableStn(){testnet.stnEnabled=!1}Object.defineProperty(testnet,"port",{enumerable:!0,configurable:!1,get:function(){return this.regtestEnabled?REGTEST.PORT:this.stnEnabled?STN.PORT:TESTNET.PORT}}),Object.defineProperty(testnet,"networkMagic",{enumerable:!0,configurable:!1,get:function(){return this.regtestEnabled?JSUtil.integerAsBuffer(REGTEST.NETWORK_MAGIC):this.stnEnabled?JSUtil.integerAsBuffer(STN.NETWORK_MAGIC):JSUtil.integerAsBuffer(TESTNET.NETWORK_MAGIC)}}),Object.defineProperty(testnet,"dnsSeeds",{enumerable:!0,configurable:!1,get:function(){return this.regtestEnabled?REGTEST.DNS_SEEDS:this.stnEnabled?STN.DNS_SEEDS:TESTNET.DNS_SEEDS}}),Object.defineProperty(testnet,"cashAddrPrefix",{enumerable:!0,configurable:!1,get:function(){return this.regtestEnabled?REGTEST.CASHADDRPREFIX:this.stnEnabled?STN.CASHADDRPREFIX:TESTNET.CASHADDRPREFIX}}),Object.defineProperty(testnet,"cashAddrPrefixArray",{enumerable:!0,configurable:!1,get:function(){return this.regtestEnabled?cashAddrPrefixToArray(REGTEST.CASHADDRPREFIX):this.stnEnabled?STN.cashAddrPrefixToArray(STN.CASHADDRPREFIX):cashAddrPrefixToArray(TESTNET.CASHADDRPREFIX)}}),module.exports={add:addNetwork,remove:removeNetwork,defaultNetwork:livenet,livenet,mainnet:livenet,testnet,regtest,stn,get,enableRegtest,disableRegtest,enableStn,disableStn};